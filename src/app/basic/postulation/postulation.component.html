<div class="container-xl">
  <div class="table-responsive">
    <div class="table-wrapper">
      <div class="table-title">
        <div class="row">
          <div class="col-sm-8">
            <h2>Liste des <b>Postulations</b></h2>
          </div>
          <div class="col-sm-4 d-flex justify-content-end align-items-center">
             <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
      <button nz-button nzType="primary" (click)="showAddForm = !showAddForm">
        {{ showAddForm ? 'Annuler' : 'Postuler pour des Grdiens' }}
      </button>
       <input 
        nz-input 
        [(ngModel)]="searchTerm" 
        (input)="onFilterInput()" 
        placeholder="Rechercher par proprietaire ou gardien"
        style="max-width: 300px;"
      />
          </div>
             <!-- ✅ FORMULAIRE DE POSTULATION -->
      <nz-card *ngIf="showAddForm" nzTitle="Nouvelle Postulation" class="mb-4" [nzBordered]="true">
        <form #form="ngForm" (ngSubmit)="onSubmitPostulation(form)">
          
          <!-- Sélection de recherche -->
          <label for="search_id">Choisir une recherche :</label>
          <select
            id="search_id"
            [(ngModel)]="newPostulation.search_id"
            name="search_id"
            required
            class="form-control mb-3"
          >
 <option *ngFor="let s of Searchs" [ngValue]="s.id">
   {{ s.id }} — {{ s.user_name }} — {{ s.pet_type }} ({{ s.start_date| date:'dd/MM/yyyy' }} → {{ s.end_date| date:'dd/MM/yyyy' }}) à {{ s.adresse }}
  </option>          </select>
                    

          <!-- Liste des gardiens avec cases à cocher -->
          <label>Choisir un ou plusieurs gardiens :</label>
         <div *ngFor="let sitter of petSitters[0]?.petSitters" class="checkbox-line">
  <label
    [ngClass]="{
      'already-postulated': hasAlreadyPostulated(sitter.id)
    }"
  >
    <input
      type="checkbox"
      [value]="sitter.id"
      [disabled]="hasAlreadyPostulated(sitter.id)"
      (change)="onSitterCheckboxChange(sitter.id, $event)"
    />
    {{ sitter.first_name }} {{ sitter.last_name }}
    <span *ngIf="hasAlreadyPostulated(sitter.id)" class="badge bg-success">
      Déjà postulé
    </span>
  </label>
</div>


          <!-- Bouton de soumission -->
          <button nz-button nzType="primary" type="submit" class="mt-3">Confirmer</button>
        </form>
      </nz-card>


          </div>
        </div>
      </div>


      <table class="table table-striped table-hover table-bordered">
        <thead>
          <tr>
            <th>ID</th>
            <th>id_gardien</th>
            <th> Gardien</th>
            <th>Recherche N</th>
            <th>Propriétaire</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let postulation of Postulations">
            <td>{{ postulation.id }}</td>
            <td>{{ postulation.sitter_id }}</td>
            <td>{{ postulation.sitter_name }}</td>

            <td>{{ postulation.search_id }}</td>
            <td>{{ postulation.owner_name }}</td>
             <td>
              <select 
                [(ngModel)]="postulation.statut"
                (change)="updateStatut(postulation.id, postulation.statut)"
                class="form-select"
              >
                <option *ngFor="let option of StatutOptions" [value]="option.value">
                  {{ option.label }}
                </option>
              </select>
            </td>
            <td>
              <i nz-icon nzType="eye" nzTheme="outline" class="action-icon" title="Voir"></i>
              <i nz-icon nzType="delete" nzTheme="outline" class="action-icon text-danger" title="Supprimer"></i>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="clearfix d-flex justify-content-between align-items-center px-2 mt-3">
        <div class="hint-text">Affichage de <b>5</b> sur <b>25</b> entrées</div>
        <ul class="pagination mb-0">
          <li class="page-item disabled"><a href="#"><i class="fa fa-angle-double-left"></i></a></li>
          <li class="page-item"><a href="#" class="page-link">1</a></li>
          <li class="page-item"><a href="#" class="page-link">2</a></li>
          <li class="page-item active"><a href="#" class="page-link">3</a></li>
          <li class="page-item"><a href="#" class="page-link">4</a></li>
          <li class="page-item"><a href="#" class="page-link">5</a></li>
          <li class="page-item"><a href="#" class="page-link"><i class="fa fa-angle-double-right"></i></a></li>
        </ul>
      </div>
    </div>
  </div>
</div>
